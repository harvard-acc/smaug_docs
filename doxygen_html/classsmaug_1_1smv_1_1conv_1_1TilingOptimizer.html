<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SMAUG: smaug::smv::conv::TilingOptimizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SMAUG
   </div>
   <div id="projectbrief">Simulating Machine Learning Applications on gem5-Aladdin</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacesmaug.html">smaug</a></li><li class="navelem"><a class="el" href="namespacesmaug_1_1smv.html">smv</a></li><li class="navelem"><a class="el" href="namespacesmaug_1_1smv_1_1conv.html">conv</a></li><li class="navelem"><a class="el" href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html">TilingOptimizer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">smaug::smv::conv::TilingOptimizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Tiling optimizer for SMV convolution kernel.  
 <a href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="smv__convolution__tiling_8h_source.html">smv_convolution_tiling.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for smaug::smv::conv::TilingOptimizer:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.png" usemap="#smaug::smv::conv::TilingOptimizer_map" alt=""/>
  <map id="smaug::smv::conv::TilingOptimizer_map" name="smaug::smv::conv::TilingOptimizer_map">
<area href="classsmaug_1_1smv_1_1TilingOptimizerBase.html" alt="smaug::smv::TilingOptimizerBase" shape="rect" coords="0,0,199,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a8d6428f2e92cd817dd4020c22ee72465"><td class="memItemLeft" align="right" valign="top"><a id="a8d6428f2e92cd817dd4020c22ee72465"></a>
static std::array&lt; <a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a>, 3 &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>doTiling</b> (<a class="el" href="classsmaug_1_1SmvConvolutionOp.html">SmvConvolutionOp</a> *op)</td></tr>
<tr class="separator:a8d6428f2e92cd817dd4020c22ee72465"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6989a579f489679ee6ce19d3f863fc1b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structsmaug_1_1smv_1_1TilingConfig.html">TilingConfig</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#a6989a579f489679ee6ce19d3f863fc1b">computeBasicTileShapes</a> (<a class="el" href="classsmaug_1_1SmvConvolutionOp.html">SmvConvolutionOp</a> *op)</td></tr>
<tr class="memdesc:a6989a579f489679ee6ce19d3f863fc1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine the best basic tiling shape for this convolution layer.  <a href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#a6989a579f489679ee6ce19d3f863fc1b">More...</a><br /></td></tr>
<tr class="separator:a6989a579f489679ee6ce19d3f863fc1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab537f0f0783fed48faf1fb03073c830e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#ab537f0f0783fed48faf1fb03073c830e">generateRowwiseOutputTiledTensor</a> (<a class="el" href="classsmaug_1_1SmvConvolutionOp.html">SmvConvolutionOp</a> *op, const <a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a> &amp;inputTiledTensor, const <a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a> &amp;weightsTiledTensor, const <a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> &amp;maxOutputTileSize, <a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *outputTensor, bool copyData=false)</td></tr>
<tr class="memdesc:ab537f0f0783fed48faf1fb03073c830e"><td class="mdescLeft">&#160;</td><td class="mdescRight">A specialized output tiling function when the output is tiled rowwise.  <a href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#ab537f0f0783fed48faf1fb03073c830e">More...</a><br /></td></tr>
<tr class="separator:ab537f0f0783fed48faf1fb03073c830e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:a09a2b2017f8b3a12dd5c585abd2eb6ea"><td class="memItemLeft" align="right" valign="top">static std::array&lt; <a class="el" href="namespacesmaug_1_1smv.html#a3570fbfb36362c2c1e52c12684656d09">TilingDims</a>, 3 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#a09a2b2017f8b3a12dd5c585abd2eb6ea">determineBestTilingDims</a> (<a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *inputs, <a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *weights, <a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *outputs, int maxTileSize)</td></tr>
<tr class="memdesc:a09a2b2017f8b3a12dd5c585abd2eb6ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine the best tiling dimensions for running convolution on SMV.  <a href="classsmaug_1_1smv_1_1conv_1_1TilingOptimizer.html#a09a2b2017f8b3a12dd5c585abd2eb6ea">More...</a><br /></td></tr>
<tr class="separator:a09a2b2017f8b3a12dd5c585abd2eb6ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td colspan="2" onclick="javascript:toggleInherit('pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase')"><img src="closed.png" alt="-"/>&#160;Static Protected Member Functions inherited from <a class="el" href="classsmaug_1_1smv_1_1TilingOptimizerBase.html">smaug::smv::TilingOptimizerBase</a></td></tr>
<tr class="memitem:a8aab93a6c10d6f22be52fdd1e2c511c7 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacesmaug_1_1smv.html#a3570fbfb36362c2c1e52c12684656d09">TilingDims</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1smv_1_1TilingOptimizerBase.html#a8aab93a6c10d6f22be52fdd1e2c511c7">findBestTilingDims</a> (const <a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> &amp;shape, int maxTileSize, const std::vector&lt; int &gt; &amp;minShape)</td></tr>
<tr class="memdesc:a8aab93a6c10d6f22be52fdd1e2c511c7 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the best set of dimensions to tile a given tensor shape.  <a href="classsmaug_1_1smv_1_1TilingOptimizerBase.html#a8aab93a6c10d6f22be52fdd1e2c511c7">More...</a><br /></td></tr>
<tr class="separator:a8aab93a6c10d6f22be52fdd1e2c511c7 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a179fef7a4b60f89f851672c415e02374 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1smv_1_1TilingOptimizerBase.html#a179fef7a4b60f89f851672c415e02374">enum2DTensorTilingConfigs</a> (<a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> shape, int maxTileSize, const std::vector&lt; int &gt; &amp;minShape, const std::vector&lt; int &gt; &amp;strides, std::vector&lt; <a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> &gt; &amp;configs)</td></tr>
<tr class="memdesc:a179fef7a4b60f89f851672c415e02374 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumerates all tiling configs for a two dimensional <a class="el" href="classsmaug_1_1Tensor.html" title="Tensor represents a single multi-dimensional array of data.">Tensor</a>.  <a href="classsmaug_1_1smv_1_1TilingOptimizerBase.html#a179fef7a4b60f89f851672c415e02374">More...</a><br /></td></tr>
<tr class="separator:a179fef7a4b60f89f851672c415e02374 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3a14b402962e85546faaf30d2636239 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1smv_1_1TilingOptimizerBase.html#ac3a14b402962e85546faaf30d2636239">enum4DTensorTilingConfigs</a> (<a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> shape, int maxTileSize, const std::vector&lt; int &gt; &amp;minShape, const std::vector&lt; int &gt; &amp;strides, std::vector&lt; <a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> &gt; &amp;configs)</td></tr>
<tr class="memdesc:ac3a14b402962e85546faaf30d2636239 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumerates all tiling configs for a four dimensional <a class="el" href="classsmaug_1_1Tensor.html" title="Tensor represents a single multi-dimensional array of data.">Tensor</a>.  <a href="classsmaug_1_1smv_1_1TilingOptimizerBase.html#ac3a14b402962e85546faaf30d2636239">More...</a><br /></td></tr>
<tr class="separator:ac3a14b402962e85546faaf30d2636239 inherit pro_static_methods_classsmaug_1_1smv_1_1TilingOptimizerBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Tiling optimizer for SMV convolution kernel. </p>

<p class="definition">Definition at line <a class="el" href="smv__convolution__tiling_8h_source.html#l00019">19</a> of file <a class="el" href="smv__convolution__tiling_8h_source.html">smv_convolution_tiling.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a6989a579f489679ee6ce19d3f863fc1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6989a579f489679ee6ce19d3f863fc1b">&#9670;&nbsp;</a></span>computeBasicTileShapes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsmaug_1_1smv_1_1TilingConfig.html">TilingConfig</a> smaug::smv::conv::TilingOptimizer::computeBasicTileShapes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsmaug_1_1SmvConvolutionOp.html">SmvConvolutionOp</a> *&#160;</td>
          <td class="paramname"><em>op</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determine the best basic tiling shape for this convolution layer. </p>
<p>The algorithm first determines the dimensions along which the inputs, weights, and outputs will be tiled. Then based on those dimensions, we enumerate all possible basic tile shapes for inputs, weights, and outputs. A <b>basic</b> shape is the shape that all but potentially the last tile along a set of dimensions will use. This triplet of tile shapes defines a <a class="el" href="structsmaug_1_1smv_1_1TilingConfig.html" title="A TilingConfig describes tiling strategies and optimal tile sizes for inputs, weights,...">TilingConfig</a>. The <a class="el" href="structsmaug_1_1smv_1_1TilingConfig.html" title="A TilingConfig describes tiling strategies and optimal tile sizes for inputs, weights,...">TilingConfig</a> that maximizes the total combined size of input, weights, and output tiles is chosen as the best.</p>
<p>To limit the number of possibilities, we only enumerate each dimension in certain increments. For example, input channels are only enumerated in multiples of kNumMaccsPerPE, and output channels are only enumerated in multiples in kNumPEs.</p>
<p>This algorithm assumes that the maximum tile size for weights, inputs, and outputs are all the same and that they will reside in separate scratchpads (no sharing).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">op</td><td>The SMV convolution operator. All tensors must have been created with createAllTensors() prior to calling this function. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The <a class="el" href="structsmaug_1_1smv_1_1TilingConfig.html" title="A TilingConfig describes tiling strategies and optimal tile sizes for inputs, weights,...">TilingConfig</a> that describes the best tiling shapes. </dd></dl>

<p class="definition">Definition at line <a class="el" href="smv__convolution__tiling_8cpp_source.html#l00057">57</a> of file <a class="el" href="smv__convolution__tiling_8cpp_source.html">smv_convolution_tiling.cpp</a>.</p>

</div>
</div>
<a id="a09a2b2017f8b3a12dd5c585abd2eb6ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09a2b2017f8b3a12dd5c585abd2eb6ea">&#9670;&nbsp;</a></span>determineBestTilingDims()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::array&lt; <a class="el" href="namespacesmaug_1_1smv.html#a3570fbfb36362c2c1e52c12684656d09">TilingDims</a>, 3 &gt; smaug::smv::conv::TilingOptimizer::determineBestTilingDims </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *&#160;</td>
          <td class="paramname"><em>inputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *&#160;</td>
          <td class="paramname"><em>weights</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *&#160;</td>
          <td class="paramname"><em>outputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxTileSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determine the best tiling dimensions for running convolution on SMV. </p>
<p>This function imposes some additional constraints on the tiling dimensions, in that certain combinations of input/weight/output tiling dimensions are not allowed in the interest of tiling code complexity.</p>
<dl class="section return"><dt>Returns</dt><dd>A 3-element array of TilingDims enums (inputs, weights, outputs). </dd></dl>

<p class="definition">Definition at line <a class="el" href="smv__convolution__tiling_8cpp_source.html#l00013">13</a> of file <a class="el" href="smv__convolution__tiling_8cpp_source.html">smv_convolution_tiling.cpp</a>.</p>

</div>
</div>
<a id="ab537f0f0783fed48faf1fb03073c830e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab537f0f0783fed48faf1fb03073c830e">&#9670;&nbsp;</a></span>generateRowwiseOutputTiledTensor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a> smaug::smv::conv::TilingOptimizer::generateRowwiseOutputTiledTensor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classsmaug_1_1SmvConvolutionOp.html">SmvConvolutionOp</a> *&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a> &amp;&#160;</td>
          <td class="paramname"><em>inputTiledTensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classsmaug_1_1TiledTensor.html">TiledTensor</a> &amp;&#160;</td>
          <td class="paramname"><em>weightsTiledTensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classsmaug_1_1TensorShape.html">TensorShape</a> &amp;&#160;</td>
          <td class="paramname"><em>maxOutputTileSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classsmaug_1_1Tensor.html">Tensor</a> *&#160;</td>
          <td class="paramname"><em>outputTensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>copyData</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A specialized output tiling function when the output is tiled rowwise. </p>
<p>This accounts for additional corner cases in filter field size and zero-padding that arise with specific inputs/weights tile sizes. </p>

<p class="definition">Definition at line <a class="el" href="smv__convolution__tiling_8cpp_source.html#l00249">249</a> of file <a class="el" href="smv__convolution__tiling_8cpp_source.html">smv_convolution_tiling.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>smaug/operators/smv/<a class="el" href="smv__convolution__tiling_8h_source.html">smv_convolution_tiling.h</a></li>
<li>smaug/operators/smv/<a class="el" href="smv__convolution__tiling_8cpp_source.html">smv_convolution_tiling.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
