<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SMAUG: smaug::ThreadPool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SMAUG
   </div>
   <div id="projectbrief">Simulating Machine Learning Applications on gem5-Aladdin</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacesmaug.html">smaug</a></li><li class="navelem"><a class="el" href="classsmaug_1_1ThreadPool.html">ThreadPool</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-static-methods">Static Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classsmaug_1_1ThreadPool-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">smaug::ThreadPool Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A user-space cooperatve thread pool implementation designed for <a class="el" href="namespacesmaug_1_1gem5.html" title="Contains utility functions for interacting with gem5.">gem5</a> in SE mode.  
 <a href="classsmaug_1_1ThreadPool.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="thread__pool_8h_source.html">thread_pool.h</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A user-space cooperatve thread pool implementation designed for <a class="el" href="namespacesmaug_1_1gem5.html" title="Contains utility functions for interacting with gem5.">gem5</a> in SE mode. </p>
<p>Multithreading in <a class="el" href="namespacesmaug_1_1gem5.html" title="Contains utility functions for interacting with gem5.">gem5</a> SE mode is tricky - while we can spawn pthreads, we cannot let threads terminate when the pthread function returns, because the ThreadContext would be destroyed, which prevents us from ever using the CPU that was assigned to that ThreadContext. The solution is to run an infinite loop on all the threads in the pool and assign work to them from a queue.</p>
<p>To prevent wasting simulation time with spinloops, this thread pool implementation quiesces all inactive CPUs and wakes them up only when there is work to do. This is done via magic <a class="el" href="namespacesmaug_1_1gem5.html" title="Contains utility functions for interacting with gem5.">gem5</a> instructions. </p>

<p class="definition">Definition at line <a class="el" href="thread__pool_8h_source.html#l00023">23</a> of file <a class="el" href="thread__pool_8h_source.html">thread_pool.h</a>.</p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsmaug_1_1ThreadPool_1_1ThreadInitArgs.html">ThreadInitArgs</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsmaug_1_1ThreadPool_1_1WorkerThread.html">WorkerThread</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">All state and metadata for a worker thread.  <a href="structsmaug_1_1ThreadPool_1_1WorkerThread.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ab636b3556a83f56de3e43c193043670a"><td class="memItemLeft" align="right" valign="top"><a id="ab636b3556a83f56de3e43c193043670a"></a>
typedef void *(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#ab636b3556a83f56de3e43c193043670a">WorkerThreadFunc</a>) (void *)</td></tr>
<tr class="memdesc:ab636b3556a83f56de3e43c193043670a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function signature for any work to be executed on a worker thread. <br /></td></tr>
<tr class="separator:ab636b3556a83f56de3e43c193043670a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abe6a9a33c4a6afa10baaa1a7214ec01a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#abe6a9a33c4a6afa10baaa1a7214ec01a">ThreadPool</a> (int nthreads)</td></tr>
<tr class="memdesc:abe6a9a33c4a6afa10baaa1a7214ec01a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a <a class="el" href="classsmaug_1_1ThreadPool.html" title="A user-space cooperatve thread pool implementation designed for gem5 in SE mode.">ThreadPool</a> with N threads.  <a href="classsmaug_1_1ThreadPool.html#abe6a9a33c4a6afa10baaa1a7214ec01a">More...</a><br /></td></tr>
<tr class="separator:abe6a9a33c4a6afa10baaa1a7214ec01a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafcef6eb95c35a4da1d8e1827cb91ee8"><td class="memItemLeft" align="right" valign="top"><a id="aafcef6eb95c35a4da1d8e1827cb91ee8"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#aafcef6eb95c35a4da1d8e1827cb91ee8">size</a> () const</td></tr>
<tr class="memdesc:aafcef6eb95c35a4da1d8e1827cb91ee8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of worker threads. <br /></td></tr>
<tr class="separator:aafcef6eb95c35a4da1d8e1827cb91ee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae863b5a0a2d12242c2545dcefa795439"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#ae863b5a0a2d12242c2545dcefa795439">initThreadPool</a> ()</td></tr>
<tr class="memdesc:ae863b5a0a2d12242c2545dcefa795439"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the thread pool.  <a href="classsmaug_1_1ThreadPool.html#ae863b5a0a2d12242c2545dcefa795439">More...</a><br /></td></tr>
<tr class="separator:ae863b5a0a2d12242c2545dcefa795439"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a899c9cf51b8f776b1e14d0fc34bcded3"><td class="memItemLeft" align="right" valign="top"><a id="a899c9cf51b8f776b1e14d0fc34bcded3"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#a899c9cf51b8f776b1e14d0fc34bcded3">dispatchThread</a> (<a class="el" href="classsmaug_1_1ThreadPool.html#ab636b3556a83f56de3e43c193043670a">WorkerThreadFunc</a> func, void *args)</td></tr>
<tr class="memdesc:a899c9cf51b8f776b1e14d0fc34bcded3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispatch the function to a worker in the thread pool. <br /></td></tr>
<tr class="separator:a899c9cf51b8f776b1e14d0fc34bcded3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20fa766472923e64de201d81e84df4af"><td class="memItemLeft" align="right" valign="top"><a id="a20fa766472923e64de201d81e84df4af"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#a20fa766472923e64de201d81e84df4af">joinThreadPool</a> ()</td></tr>
<tr class="memdesc:a20fa766472923e64de201d81e84df4af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for all threads in the pool to finish work. <br /></td></tr>
<tr class="separator:a20fa766472923e64de201d81e84df4af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr class="memitem:a9154b5da8b300c0596328d91201fa110"><td class="memItemLeft" align="right" valign="top"><a id="a9154b5da8b300c0596328d91201fa110"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#a9154b5da8b300c0596328d91201fa110">ThreadStatus</a> { <b>Uninitialized</b>, 
<b>Idle</b>, 
<b>Running</b>
 }</td></tr>
<tr class="memdesc:a9154b5da8b300c0596328d91201fa110"><td class="mdescLeft">&#160;</td><td class="mdescRight">Possible worker thread states. <br /></td></tr>
<tr class="separator:a9154b5da8b300c0596328d91201fa110"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-methods"></a>
Static Protected Member Functions</h2></td></tr>
<tr class="memitem:a6b1517ceba5c2cf3cde9b17d353513af"><td class="memItemLeft" align="right" valign="top"><a id="a6b1517ceba5c2cf3cde9b17d353513af"></a>
static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#a6b1517ceba5c2cf3cde9b17d353513af">workerLoop</a> (void *args)</td></tr>
<tr class="memdesc:a6b1517ceba5c2cf3cde9b17d353513af"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main event loop executed by all worker threads. <br /></td></tr>
<tr class="separator:a6b1517ceba5c2cf3cde9b17d353513af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ad36eb512607274e0dc9ed086f6b7716c"><td class="memItemLeft" align="right" valign="top"><a id="ad36eb512607274e0dc9ed086f6b7716c"></a>
std::vector&lt; <a class="el" href="structsmaug_1_1ThreadPool_1_1WorkerThread.html">WorkerThread</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsmaug_1_1ThreadPool.html#ad36eb512607274e0dc9ed086f6b7716c">workers</a></td></tr>
<tr class="memdesc:ad36eb512607274e0dc9ed086f6b7716c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Worker threads. <br /></td></tr>
<tr class="separator:ad36eb512607274e0dc9ed086f6b7716c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="abe6a9a33c4a6afa10baaa1a7214ec01a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe6a9a33c4a6afa10baaa1a7214ec01a">&#9670;&nbsp;</a></span>ThreadPool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">smaug::ThreadPool::ThreadPool </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nthreads</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a <a class="el" href="classsmaug_1_1ThreadPool.html" title="A user-space cooperatve thread pool implementation designed for gem5 in SE mode.">ThreadPool</a> with N threads. </p>
<p>The simulation must be created with at least N+1 CPUs, since we need one CPU to run the main thread. </p>

<p class="definition">Definition at line <a class="el" href="thread__pool_8cpp_source.html#l00008">8</a> of file <a class="el" href="thread__pool_8cpp_source.html">thread_pool.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ae863b5a0a2d12242c2545dcefa795439"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae863b5a0a2d12242c2545dcefa795439">&#9670;&nbsp;</a></span>initThreadPool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void smaug::ThreadPool::initThreadPool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the thread pool. </p>
<p>Initialization must be postponed until after fast-forwarding is finished, or we will get incorrect CPU IDs.</p>
<p>This can only be called once; any subsequent call will assert fail. </p>

<p class="definition">Definition at line <a class="el" href="thread__pool_8cpp_source.html#l00066">66</a> of file <a class="el" href="thread__pool_8cpp_source.html">thread_pool.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>smaug/utility/<a class="el" href="thread__pool_8h_source.html">thread_pool.h</a></li>
<li>smaug/utility/<a class="el" href="thread__pool_8cpp_source.html">thread_pool.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
